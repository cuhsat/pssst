function Pssst(e){function i(e,t){for(k in t){e=e.replace(new RegExp("{{"+k+"}}","gi"),t[k])}return e}function s(e,t){$(".pssst #flash-"+e).text(t).fadeIn().delay(3e3).fadeOut()}function o(e){$(".pssst #user").html(t+"."+e+' <b class="caret"></b>');$(".pssst .messages").finish().hide();$(".pssst #messages-"+e).finish().fadeIn(350);var n=$(".pssst .box");var e=$(".pssst #box-"+e);n.removeClass("fa-folder-open").addClass("fa-folder");e.removeClass("fa-folder").addClass("fa-folder-open")}var t=null,n="box";var r={api:{key:CryptoJS.enc.Hex.parse(e.substring(0,64)),iv:CryptoJS.enc.Hex.parse(e.substring(64)),encrypt:function(t){t=CryptoJS.AES.encrypt(t,r.api.key,{iv:r.api.iv});t=t.toString();return t},decrypt:function(t){t=CryptoJS.AES.decrypt(t,r.api.key,{iv:r.api.iv});t=CryptoJS.enc.Utf8.stringify(t);return t},call:function(t,n,i){var s=JSON.stringify({method:t,args:n||[]});$.post("/call",{params:r.api.encrypt(s)},function(e){try{i(null,JSON.parse(r.api.decrypt(e)))}catch(t){i(t)}},"text").fail(function(e,t,n){i(r.api.decrypt(e.responseText))})}},call:function(t,n,i){$(".pssst #throbber span").addClass("fa-spin");r.api.call(t,n,function(t,n){$(".pssst #throbber span").removeClass("fa-spin");if(!t){i(n)}else{s("error",t)}})},login:function(n){var i=$.trim($(".pssst #username").val());var o=$.trim($(".pssst #password").val());var u=[n===true,i,o];if(i&&o){r.call("login",u,function(n){if(n){t=n;$(".pssst #dialog-login").modal("hide");$(".pssst #receiver").focus();r.list()}else{s("error","Login failed")}})}},logout:function(){r.call("logout",null,function(){location.reload()})},version:function(){r.call("version",null,function(t){$(".pssst .version").text(t)})},disable:function(){r.call("delete",null,function(){r.logout()})},create:function(){var t=$(".pssst #boxname").val();if($.trim(t)!==""){r.call("create",[t],function(){r.list();o(n=t);s("info","Box created");$(".pssst #boxname").val("")})}},erase:function(){r.call("delete",[n],function(){$(".pssst #messages-"+n).remove();r.list();o(n="box");s("info","Box deleted")})},list:function(){r.call("list",null,function(t){$(".pssst #boxes").empty();t.forEach(function(e){$(".pssst #boxes").append(i("<li>"+'<a id="box-{{box}}" class="box fa fa-folder" href="">'+"&nbsp;&nbsp;{{box}}"+"</a>"+"</li>",{box:e}));if($(".pssst #messages-"+e).length===0){$(".pssst #content").append(i('<div id="messages-{{box}}" class="messages"></div>',{box:e}))}});$(".pssst .box").click(function(){o(n=$.trim($(this).text()))});o(n)})},push:function(){var t=$.trim($(".pssst #receiver").val());var n=$.trim($(".pssst #message").val());if(t&&n){r.call("push",[[t],n],function(t){s("info","Message pushed");$(".pssst #receiver").val("");$(".pssst #message").val("")})}},pull:function(){r.call("pull",[n],function(t){if(t){$(".pssst #messages-"+n).append(i('<div class="message well">'+"<span>{{text}}</span><br/><small>- {{user}} {{time}}</small>"+"</div>",{text:t[2].replace(/\n/g,"<br/>"),user:"pssst."+t[0],time:new Date(t[1]*1e3)}));$(".pssst #messages-"+n+" .message:last-child").fadeIn(350);$("html, body").animate({scrollTop:$(document).height()},"slow")}})}};$(".pssst").on("click","a",function(t){var n=$(this).attr("href");if(n===""){$(this).attr("href","#"+e)}});$(".pssst #username, .pssst #password").keypress(function(e){if(e.which==13){$(".pssst #login-exists").click()}});$(".pssst #receiver").keypress(function(e){if(e.which==13){$(".pssst #push").click()}});$(".pssst #login-create").click(function(){r.login(true)});$(".pssst #login-exists").click(r.login);$(".pssst #logout").click(r.logout);$(".pssst #disable").click(r.disable);$(".pssst #create").click(r.create);$(".pssst #delete").click(r.erase);$(".pssst #push").click(r.push);$(".pssst .modal").modal({backdrop:"static",keyboard:false,show:false});$(".pssst #dialog-login").modal("show");r.version();setInterval(function(){if(t)r.pull()},2e3);return this}$(document).ready(function(){var e=location.hash.replace("#","");if(e){var t=Pssst(e)}else{location.href="about:blank"}})