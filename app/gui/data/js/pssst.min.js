function Pssst(s){function t(s,t){for(k in t)s=s.replace(new RegExp("{{"+k+"}}","gi"),t[k]);return s}function e(s,t){$(".pssst #flash-"+s).text(t).fadeIn().delay(3e3).fadeOut()}function n(s){$(".pssst #user").html(i+"."+s+' <b class="caret"></b>'),$(".pssst section").finish().hide(),$(".pssst #messages-"+s).finish().fadeIn(350);var t=$(".pssst .box"),s=$(".pssst #box-"+s);t.removeClass("fa-folder-open").addClass("fa-folder"),s.removeClass("fa-folder").addClass("fa-folder-open")}var i=null,a="box",l={api:{key:CryptoJS.enc.Hex.parse(s.substring(0,64)),iv:CryptoJS.enc.Hex.parse(s.substring(64)),encrypt:function(s){return s=CryptoJS.AES.encrypt(s,l.api.key,{iv:l.api.iv}),s=s.toString()},decrypt:function(s){return s=CryptoJS.AES.decrypt(s,l.api.key,{iv:l.api.iv}),s=CryptoJS.enc.Utf8.stringify(s)},call:function(s,t,e){var n=JSON.stringify({method:s,args:t||[]});$.post("/call",{params:l.api.encrypt(n)},function(s){try{e(null,JSON.parse(l.api.decrypt(s)))}catch(t){e(t)}},"text").fail(function(s){e(l.api.decrypt(s.responseText))})}},call:function(s,t,n){$(".pssst #throbber span").addClass("fa-spin"),l.api.call(s,t,function(s,t){$(".pssst #throbber span").removeClass("fa-spin"),s?e("error",s):n(t)})},login:function(s){var t=$.trim($(".pssst #username").val()),n=$.trim($(".pssst #password").val()),a=[s===!0,t,n];t&&n&&l.call("login",a,function(s){s?(i=s,$(".pssst #dialog-login").modal("hide"),$(".pssst #receiver").focus(),l.list()):e("error","Login failed")})},logout:function(){l.call("logout",null,function(){location.reload()})},version:function(){l.call("version",null,function(s){$(".pssst .version").text(s)})},disable:function(){l.call("delete",null,function(){l.logout()})},create:function(){var s=$(".pssst #boxname").val();""!==$.trim(s)&&l.call("create",[s],function(){l.list(),n(a=s),e("info","Box created"),$(".pssst #boxname").val("")})},erase:function(){l.call("delete",[a],function(){$(".pssst #messages-"+a).remove(),l.list(),n(a="box"),e("info","Box deleted")})},list:function(){l.call("list",null,function(s){$(".pssst #boxes").empty(),s.forEach(function(s){$(".pssst #boxes").append(t('<li><a id="box-{{box}}" class="box fa fa-folder" href="">&nbsp;&nbsp;{{box}}</a></li>',{box:s})),0===$(".pssst #messages-"+s).length&&$(".pssst #content").append(t('<section id="messages-{{box}}"></section>',{box:s}))}),$(".pssst .box").click(function(){n(a=$.trim($(this).text()))}),n(a)})},push:function(){var s=$.trim($(".pssst #receiver").val()),t=$.trim($(".pssst #message").val());s&&t&&l.call("push",[[s],t],function(){e("info","Message pushed"),$(".pssst #receiver").val(""),$(".pssst #message").val("")})},pull:function(){l.call("pull",[a],function(s){s&&($(".pssst #messages-"+a).append(t('<article class="well"><span>{{text}}</span><br/><small>- {{user}} {{time}}</small></article>',{text:s[2].replace(/\n/g,"<br/>"),user:"pssst."+s[0],time:new Date(1e3*s[1])})),$(".pssst #messages-"+a+" article:last-child").fadeIn(350),$("html, body").animate({scrollTop:$(document).height()},"slow"))})}};return $(".pssst").on("click","a",function(){var t=$(this).attr("href");""===t&&$(this).attr("href","#"+s)}),$(".pssst #username, .pssst #password").keypress(function(s){13==s.which&&$(".pssst #login-exists").click()}),$(".pssst #receiver").keypress(function(s){13==s.which&&$(".pssst #push").click()}),$(".pssst #login-create").click(function(){l.login(!0)}),$(".pssst #login-exists").click(l.login),$(".pssst #logout").click(l.logout),$(".pssst #disable").click(l.disable),$(".pssst #create").click(l.create),$(".pssst #delete").click(l.erase),$(".pssst #push").click(l.push),$(".pssst .modal").modal({backdrop:"static",keyboard:!1,show:!1}),$(".pssst #dialog-login").modal("show"),l.version(),setInterval(function(){i&&l.pull()},2e3),this}$(document).ready(function(){var s=location.hash.replace("#","");if(s){Pssst(s)}else location.href="about:blank"});